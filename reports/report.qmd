---
title: Homework 8 - World Bank Analysis
---

GITHUB URL: <https://github.com/cmsc-vcu/cmsc408-sp2025-hw8-ishaamalikk>

```{python}
from helpers import create_database_engine, run_sql_and_return_df, run_sql_and_return_html, create_db_wrapper, execute_ddl_from_file, execute_ddl

config_map = {
  'user': "CMSC408_HW8_USER",
  'password': "CMSC408_HW8_PASSWORD",
  'host': "CMSC408_HW8_HOST",
  'database': "CMSC408_HW8_DB_NAME"
}

cnx,config = create_db_wrapper(config_map)
```

```{python}
run_sql_and_return_html(cnx, """
SELECT table_schema, table_name, table_rows
FROM information_schema.tables
WHERE table_schema IN ('world_bank_data')
""")
```

## Task 1
```{python}
run_sql_and_return_html(cnx, """
SELECT COUNT(*) AS "Row Count"
FROM world_bank_data.wdi_country
""")
```

## Task 2
```{python}
run_sql_and_return_html(cnx, """
SELECT *
FROM world_bank_data.wdi_country
LIMIT 10
""")
```

## Task 3
```{python}
run_sql_and_return_html(cnx, """
SELECT *
FROM world_bank_data.wdi_country
WHERE country_is_country = 0
""")
```

## Task 4
```{python}
execute_ddl(cnx, """
DROP TABLE IF EXISTS wdi_country;
""")
```
```{python}
execute_ddl(cnx, """
CREATE TABLE wdi_country AS
SELECT *
FROM world_bank_data.wdi_country
WHERE country_is_country = 1;
""")
```
```{python}
run_sql_and_return_html(cnx, """
SELECT COUNT(*) FROM wdi_country
""")
```

## Task 5
```{python}
run_sql_and_return_html(cnx, """
SELECT COUNT(*)
FROM wdi_country
""")
```

## Task 6
```{python}
run_sql_and_return_html(cnx, """
SELECT DISTINCT country_region
FROM wdi_country
ORDER BY country_region
""")
```

## Task 7
```{python}
run_sql_and_return_html(cnx, """
SELECT country_region, COUNT(*) AS num_countries
FROM wdi_country
GROUP BY country_region
ORDER BY num_countries DESC
""")
```

## Task 8
```{python}
run_sql_and_return_html(cnx, """
SELECT country_name, country_region
FROM wdi_country
WHERE country_region = 'North America'
ORDER BY country_name
""")
```

## Task 9
```{python}
run_sql_and_return_html(cnx, """
SELECT country_region, country_name, country_long_name
FROM wdi_country
WHERE country_code = 'QAT'
""")
```

## Task 10
```{python}
run_sql_and_return_html(cnx, """
SELECT country_code, country_name, country_abbr, country_wb_abbr, country_region
FROM wdi_country
WHERE country_abbr <> country_wb_abbr
ORDER BY country_name
""")
```

## Task 11
```{python}
run_sql_and_return_html(cnx, """
SELECT country_income_group, COUNT(*) AS num_countries
FROM wdi_country
GROUP BY country_income_group
ORDER BY num_countries DESC
""")
```

## Task 12
```{python}
run_sql_and_return_html(cnx, """
SELECT country_name
FROM wdi_country
WHERE country_income_group IS NULL
""")
```

## Task 13
```{python}
execute_ddl(cnx, """
UPDATE wdi_country
SET country_income_group = 'High income'
WHERE country_name = 'Venezuela, RB';
""")
```
```{python}
run_sql_and_return_html(cnx, """
SELECT country_name, country_income_group
FROM wdi_country
WHERE country_name = 'Venezuela, RB'
""")
```

## Task 14
```{python}
run_sql_and_return_html(cnx, """
SELECT country_region, country_income_group, COUNT(*) AS num_countries
FROM wdi_country
GROUP BY country_region, country_income_group
ORDER BY country_region, country_income_group
""")
```

## Task 15
```{python}
run_sql_and_return_html(cnx, """
SELECT
  country_region,
  SUM(CASE WHEN country_income_group = 'High income' THEN 1 ELSE 0 END) AS High,
  SUM(CASE WHEN country_income_group = 'Upper middle income' THEN 1 ELSE 0 END) AS UpperMiddle,
  SUM(CASE WHEN country_income_group = 'Lower middle income' THEN 1 ELSE 0 END) AS LowerMiddle,
  SUM(CASE WHEN country_income_group = 'Low income' THEN 1 ELSE 0 END) AS Low,
  SUM(CASE WHEN country_income_group IS NULL THEN 1 ELSE 0 END) AS Unknown,
  COUNT(*) AS Total
FROM wdi_country
GROUP BY country_region
""")
```

## Task 16
```{python}
run_sql_and_return_html(cnx, """
SELECT COUNT(*) AS num_low_income, country_region, country_income_group
FROM wdi_country
WHERE country_income_group = 'Low income'
GROUP BY country_region, country_income_group
ORDER BY num_low_income DESC
LIMIT 1
""")
```

## Task 17
```{python}
run_sql_and_return_html(cnx, """
SELECT country_code, country_name, country_region, country_income_group
FROM wdi_country
WHERE country_region = (
  SELECT country_region
  FROM wdi_country
  WHERE country_code = 'MHL'
)
AND country_income_group = (
  SELECT country_income_group
  FROM wdi_country
  WHERE country_code = 'MHL'
)
ORDER BY country_name
""")
```

## Task 18
```{python}
run_sql_and_return_html(cnx, """
SELECT region.region, income.income
FROM
  (SELECT DISTINCT country_region AS region FROM wdi_country) AS region
CROSS JOIN
  (SELECT DISTINCT country_income_group AS income FROM wdi_country) AS income
WHERE (region.region, income.income) NOT IN (
  SELECT country_region, country_income_group
  FROM wdi_country
)
""")
```

## Task 19
```{python}
run_sql_and_return_html(cnx, """
WITH base AS (
  SELECT country_region, country_income_group, COUNT(*) AS cnt
  FROM wdi_country
  GROUP BY country_region, country_income_group
),
region_totals AS (
  SELECT country_region, COUNT(*) AS region_total
  FROM wdi_country
  GROUP BY country_region
),
income_totals AS (
  SELECT country_income_group, COUNT(*) AS income_total
  FROM wdi_country
  GROUP BY country_income_group
),
total AS (
  SELECT COUNT(*) AS grand_total FROM wdi_country
)
SELECT
  b.country_region, b.country_income_group, b.cnt,
  rt.region_total, it.income_total, t.grand_total,
  ROUND(b.cnt / t.grand_total * 100, 1) AS pct_total
FROM base b
JOIN region_totals rt ON b.country_region = rt.country_region
JOIN income_totals it ON b.country_income_group = it.country_income_group
JOIN total t
""")
```

## Task 20
run_sql_and_return_html(cnx, """
WITH base AS (
  SELECT country_region, country_income_group, COUNT(*) AS cnt
  FROM wdi_country
  GROUP BY country_region, country_income_group
),
total AS (
  SELECT COUNT(*) AS grand_total FROM wdi_country
)
SELECT
  country_region,
  ROUND(SUM(CASE WHEN country_income_group = 'High income' THEN cnt ELSE 0 END) * 100.0 / grand_total, 1) AS High,
  ROUND(SUM(CASE WHEN country_income_group = 'Upper middle income' THEN cnt ELSE 0 END) * 100.0 / grand_total, 1) AS UpperMiddle,
  ROUND(SUM(CASE WHEN country_income_group = 'Lower middle income' THEN cnt ELSE 0 END) * 100.0 / grand_total, 1) AS LowerMiddle,
  ROUND(SUM(CASE WHEN country_income_group = 'Low income' THEN cnt ELSE 0 END) * 100.0 / grand_total, 1) AS Low,
  ROUND(SUM(CASE WHEN country_income_group IS NULL THEN cnt ELSE 0 END) * 100.0 / grand_total, 1) AS Unknown
FROM base, total
GROUP BY country_region
ORDER BY country_region
""")

## Task 21
run_sql_and_return_html(cnx, """
WITH income_counts AS (
  SELECT country_income_group, COUNT(*) AS count
  FROM wdi_country
  GROUP BY country_income_group
),
total AS (
  SELECT COUNT(*) AS total_count FROM wdi_country
)
SELECT
  i.country_income_group AS income_group,
  i.count AS num_countries,
  t.total_count AS total_countries,
  ROUND(i.count * 100.0 / t.total_count, 1) AS pct_total
FROM income_counts i, total t
ORDER BY pct_total DESC
""")

## Reflection

1. I feel most confident writing `SELECT` statements and using `GROUP BY`, but I need more practice with `CROSS JOIN` and nested subqueries. This assignment gave me a solid foundation.
2. For complex tasks like Task 18, I broke them down into parts: first understanding the goal, then writing queries in steps. I used CTEs to test logic piece by piece.
3. My biggest takeaway is how powerful SQL is for data analysis and transformation. These skills will help me analyze real-world data and automate insights efficiently.

# README

A quality README is an important part of EVERY project. Using the Quarto *include* command we're including a copy of your README in the project report so that a human can evaluate it.

Make sure that you edit the README so that it's explanatory!  Note that you don't need a readme within the *reports* folder for this assignment. We're only
focused on the root *README.md*.

[Here is some info](https://www.freecodecamp.org/news/how-to-write-a-good-readme-file/) on how to write a good README!

::: {style="background:lightgray; margin-left:20px; border-top: 3px solid black; border-bottom: 3px solid black; padding-left:20px; padding-right:20px"}
{{< include ../README.md >}}
:::